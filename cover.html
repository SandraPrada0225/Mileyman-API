
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>get_carrito_by_id: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">Mileyman-API/cmd/server/handlers/get_carrito_by_id/handler.go (100.0%)</option>
				
				<option value="file1">Mileyman-API/cmd/server/handlers/get_dulce_by_code/get_dulce_by_code.go (100.0%)</option>
				
				<option value="file2">Mileyman-API/cmd/server/handlers/get_filtros/get_filtros.go (100.0%)</option>
				
				<option value="file3">Mileyman-API/cmd/server/handlers/ping/ping.go (100.0%)</option>
				
				<option value="file4">Mileyman-API/internal/repositories/carritos/repository.go (100.0%)</option>
				
				<option value="file5">Mileyman-API/internal/repositories/categorias/repository.go (50.0%)</option>
				
				<option value="file6">Mileyman-API/internal/repositories/dulces/repository.go (51.9%)</option>
				
				<option value="file7">Mileyman-API/internal/repositories/marcas/respository.go (100.0%)</option>
				
				<option value="file8">Mileyman-API/internal/repositories/presentaciones/repository.go (100.0%)</option>
				
				<option value="file9">Mileyman-API/internal/use_case/get_carrito_by_id/implementation.go (100.0%)</option>
				
				<option value="file10">Mileyman-API/internal/use_case/get_dulce_by_code/implementation.go (100.0%)</option>
				
				<option value="file11">Mileyman-API/internal/use_case/get_filtros/implementation.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package getcarritobyid

import (
        "net/http"
        "strconv"

        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"
        "Mileyman-API/internal/domain/errors/rest"

        "github.com/gin-gonic/gin"
)

type GetCarritoUseCase interface {
        Execute(id uint64) (query.GetDetalleCarrito, error)
}

type GetDetalleCarritoById struct {
        UseCase GetCarritoUseCase
}

func (handler GetDetalleCarritoById) Handle() gin.HandlerFunc <span class="cov10" title="4">{
        return func(c *gin.Context) </span><span class="cov10" title="4">{
                id, err := strconv.ParseUint(c.Param("id"), 10, 64)
                if err != nil </span><span class="cov1" title="1">{
                        params := errormessages.Parameters{
                                "error": err.Error(),
                        }
                        c.JSON(http.StatusBadRequest, rest.NewBadRequestError(errormessages.InvalidTypeError.GetMessageWithParams(params)).Error())
                        return
                }</span>

                <span class="cov8" title="3">dulce, err := handler.UseCase.Execute(id)
                if err != nil </span><span class="cov5" title="2">{
                        switch err.(type) </span>{
                        case database.NotFoundError:<span class="cov1" title="1">
                                c.JSON(http.StatusNotFound, err.Error())</span>
                        default:<span class="cov1" title="1">
                                c.JSON(http.StatusInternalServerError, err.Error())</span>
                        }
                        <span class="cov5" title="2">return</span>
                }
                <span class="cov1" title="1">c.JSON(http.StatusOK, dulce)</span>
        }
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package getdulcebycode

// es un camarero

import (
        "net/http"

        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/domain/errors/database"

        "github.com/gin-gonic/gin"
)

type GetDulceByCode struct {
        UseCase UseCase
}

type UseCase interface {
        Execute(codigo string) (query.DetalleDulce, error)
}

func (handler GetDulceByCode) Handle() gin.HandlerFunc <span class="cov10" title="3">{
        return func(c *gin.Context) </span><span class="cov10" title="3">{
                codigo := c.Param("codigo")
                dulce, err := handler.UseCase.Execute(codigo)
                if err != nil </span><span class="cov6" title="2">{
                        switch err.(type) </span>{
                        case database.NotFoundError:<span class="cov1" title="1">
                                c.JSON(http.StatusNotFound, err.Error())</span>
                        default:<span class="cov1" title="1">
                                c.JSON(http.StatusInternalServerError, err.Error())</span>
                        }
                        <span class="cov6" title="2">return</span>
                }
                <span class="cov1" title="1">c.JSON(http.StatusOK, dulce)</span>
        }
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package getfiltros

import (
        "net/http"

        "Mileyman-API/internal/domain/dto/query"

        "github.com/gin-gonic/gin"
)

type GetFiltros struct {
        UseCase GetFiltrosUseCase
}

type GetFiltrosUseCase interface {
        Execute() (query.GetFiltros, error)
}

func (handler GetFiltros) Handle() gin.HandlerFunc <span class="cov10" title="2">{
        return func(c *gin.Context) </span><span class="cov10" title="2">{
                query, err := handler.UseCase.Execute()
                if err != nil </span><span class="cov1" title="1">{
                        c.JSON(http.StatusInternalServerError, err.Error())
                        return
                }</span>
                <span class="cov1" title="1">c.JSON(http.StatusOK, query)</span>
        }
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package ping

import "github.com/gin-gonic/gin"

type Ping struct{}

func (handler Ping) Handle() gin.HandlerFunc <span class="cov8" title="1">{
        return func(c *gin.Context) </span><span class="cov8" title="1">{
                c.String(200, "Pong")
        }</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package carritos

import (
        "errors"
        "fmt"

        "Mileyman-API/internal/domain/entities"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

func (r Repository) GetCarritoByCarritoID(carrito_id uint64) (entities.Carrito, error) <span class="cov7" title="3">{
        var carrito entities.Carrito

        err := r.DB.Where("id = ?", carrito_id).Take(&amp;carrito).Error
        if err != nil </span><span class="cov4" title="2">{
                params := errormessages.Parameters{
                        "resource":   "carrito",
                        "carrito_id": fmt.Sprint(carrito_id),
                }

                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov1" title="1">{
                        return entities.Carrito{}, database.NewNotFoundError(errormessages.CarritoNotFound.GetMessageWithParams(params))
                }</span>

                <span class="cov1" title="1">params["error"] = err.Error()
                return entities.Carrito{}, database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))</span>
        }

        <span class="cov1" title="1">return carrito, nil</span>
}
// consultamos la existencia del dulce carrito_dulce
func (r Repository) GetDulceByCarritoIDAndDulceID(carritoID uint64, dulceID uint64) (carritoDulce entities.CarritoDulce, exists bool, err error) <span class="cov7" title="3">{
        err = r.DB.Where("carrito_id = ? AND dulce_id = ?", carritoID, dulceID).First(&amp;carritoDulce).Error
        if err != nil </span><span class="cov4" title="2">{
                params := errormessages.Parameters{
                        "resource": "carrito",
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov1" title="1">{
                        exists = false
                        err = nil
                }</span> else<span class="cov1" title="1"> {
                        err = database.NewInternalServerError(errormessages.CarritoDulceNotFound.GetMessageWithParams(params))
                }</span>
                <span class="cov4" title="2">return</span>
        }
        <span class="cov1" title="1">exists = true;
        return</span>
}

// agregamos dulce al carrito o lo editamos
func (r Repository) AddDulceInCarrito(carritoDulce entities.CarritoDulce) (err error) <span class="cov10" title="5">{
        err = r.DB.Save(&amp;carritoDulce).Error
        if err != nil </span><span class="cov7" title="3">{
                params := errormessages.Parameters{
                        "resource": "carrito",
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov4" title="2">{
                        err = database.NewNotFoundError(errormessages.CarritoDulceNotFound.GetMessageWithParams(params))
                }</span> else<span class="cov1" title="1"> {
                        err = database.NewInternalServerError(errormessages.CarritoDulceNotFound.GetMessageWithParams(params))
                }</span>
        }
        <span class="cov10" title="5">return</span>
}

// eliminamos dulce del carrito
func (r Repository) DeleteDulceInCarrito(carritoDulce entities.CarritoDulce) (err error) <span class="cov8" title="4">{
        err = r.DB.Delete(&amp;carritoDulce).Error
        if err != nil </span><span class="cov7" title="3">{
                params := errormessages.Parameters{
                        "resource": "carrito",
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov1" title="1">{
                        err = database.NewNotFoundError(errormessages.CarritoDulceNotFound.GetMessageWithParams(params))
                }</span> else<span class="cov4" title="2"> {
                        err = database.NewInternalServerError(errormessages.CarritoDulceNotFound.GetMessageWithParams(params))
                }</span>
        }
        <span class="cov8" title="4">return</span>
}</pre>
		
		<pre class="file" id="file5" style="display: none">package categorias

import (
        "Mileyman-API/internal/domain/entities"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

func (r Repository) GetAll() (categorias []entities.Categoria, err error) <span class="cov0" title="0">{
        err = r.DB.Find(&amp;categorias).Error
        if err != nil </span><span class="cov0" title="0">{
                params := errormessages.Parameters{
                        "resource": "categorias",
                        "error":    err.Error(),
                }
                return []entities.Categoria{}, database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))
        }</span>

        <span class="cov0" title="0">return</span>
}

const GetCategoriasByDulceIDSP = "Call GetCategoriasByDulceID(?)"

func (r Repository) GetCategoriasByDulceID(dulceID uint64) (categorias []entities.Categoria, err error) <span class="cov10" title="2">{
        err = r.DB.Raw(GetCategoriasByDulceIDSP, dulceID).Scan(&amp;categorias).Error

        if err != nil </span><span class="cov1" title="1">{
                params := errormessages.Parameters{
                        "resource": "categorias",
                }
                err = database.NewInternalServerError(errormessages.DulceNotFound.GetMessageWithParams(params))
        }</span>

        <span class="cov10" title="2">return</span>
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package dulces

import (
        "errors"
        "fmt"

        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/domain/entities"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

const GetDetalleDulceByCodeSP = "Call GetDetalleDulceByCode(?)"

func (r Repository) GetByCode(codigo string) (detalleDulce query.DetalleDulce, err error) <span class="cov10" title="3">{
        err = r.DB.Raw(GetDetalleDulceByCodeSP, codigo).Take(&amp;detalleDulce).Error

        if err != nil </span><span class="cov6" title="2">{
                params := errormessages.Parameters{
                        "resource":   "dulces",
                        "dulce_code": codigo,
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov1" title="1">{
                        err = database.NewNotFoundError(errormessages.DulceNotFound.GetMessageWithParams(params))
                }</span> else<span class="cov1" title="1"> {
                        err = database.NewInternalServerError(errormessages.DulceNotFound.GetMessageWithParams(params))
                }</span>
        }

        <span class="cov10" title="3">return</span>
}

const GetDetalleDulceByIDSP = "Call GetDetalleDulceByID(?)"

func (r Repository) GetDetailByID(id uint64) (detalleDulce query.DetalleDulce, err error) <span class="cov10" title="3">{
        err = r.DB.Raw(GetDetalleDulceByIDSP, id).Take(&amp;detalleDulce).Error

        if err != nil </span><span class="cov6" title="2">{
                params := errormessages.Parameters{
                        "resource": "dulces",
                        "dulce_id": fmt.Sprint(id),
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov1" title="1">{
                        err = database.NewNotFoundError(errormessages.DulceNotFound.GetMessageWithParams(params))
                }</span> else<span class="cov1" title="1"> {
                        err = database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))
                }</span>
        }

        <span class="cov10" title="3">return</span>
}

func (r Repository) GetDulcesListByCarritoID(carrito_id uint64) ([]entities.CarritoDulce, error) <span class="cov0" title="0">{

        var dulcesInCarrito []entities.CarritoDulce

        err := r.DB.Model(&amp;entities.CarritoDulce{}).
                Where("carrito_id = ?", carrito_id).
                Find(&amp;dulcesInCarrito).Error
        if err != nil </span><span class="cov0" title="0">{
                params := errormessages.Parameters{
                        "resource":   "dulces",
                        "carrito_id": carrito_id,
                        "error":      err.Error(),
                }

                return []entities.CarritoDulce{}, database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))
        }</span>

        <span class="cov0" title="0">return dulcesInCarrito, nil</span>
}

func (r Repository) GetByID(id uint64) (dulce entities.Dulce, err error) <span class="cov0" title="0">{
        err = r.DB.Where("id = ?", id).Take(&amp;dulce).Error
        if err != nil </span><span class="cov0" title="0">{
                params := errormessages.Parameters{
                        "resource": "dulce",
                }
                if errors.Is(err, gorm.ErrRecordNotFound) </span><span class="cov0" title="0">{
                        err = database.NewNotFoundError(errormessages.DulceNotFound.GetMessageWithParams(params))
                }</span> else<span class="cov0" title="0"> {
                        err = database.NewInternalServerError(errormessages.DulceNotFound.GetMessageWithParams(params))
                }</span>
        }
        <span class="cov0" title="0">return</span>

}
</pre>
		
		<pre class="file" id="file7" style="display: none">package marcas

import (
        "Mileyman-API/internal/domain/entities"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"

        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

func (r Repository) GetAll() (marcas []entities.Marca, err error) <span class="cov10" title="2">{
        err = r.DB.Find(&amp;marcas).Error
        if err != nil </span><span class="cov1" title="1">{
                params := errormessages.Parameters{
                        "resource": "marcas",
                        "error":    err.Error(),
                }
                return []entities.Marca{}, database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))
        }</span>
        <span class="cov1" title="1">return</span>
}
</pre>
		
		<pre class="file" id="file8" style="display: none">package presentaciones

import (
        "Mileyman-API/internal/domain/entities"
        "Mileyman-API/internal/domain/errors/database"
        errormessages "Mileyman-API/internal/domain/errors/error_messages"
        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

func (r Repository) GetAll() (presentaciones []entities.Presentacion, err error) <span class="cov10" title="2">{
        err = r.DB.Find(&amp;presentaciones).Error
        if err != nil </span><span class="cov1" title="1">{
                params := errormessages.Parameters{
                        "resource": "marcas",
                        "error":    err.Error(),
                }
                return []entities.Presentacion{}, database.NewInternalServerError(errormessages.InternalServerError.GetMessageWithParams(params))
        }</span>
        <span class="cov1" title="1">return</span>
}
</pre>
		
		<pre class="file" id="file9" style="display: none">package getcarritobyid

import (
        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/repositories/providers"
)

type Implementation struct {
        CarritoProvider    providers.CarritosProvider
        DulcesProvider     providers.DulcesProvider
        CategoriasProvider providers.CategoriasProvider
}

func (useCase Implementation) Execute(id uint64) (query.GetDetalleCarrito, error) <span class="cov10" title="6">{
        carrito, err := useCase.CarritoProvider.GetCarritoByCarritoID(id)
        if err != nil </span><span class="cov4" title="2">{
                return query.GetDetalleCarrito{}, err
        }</span>

        <span class="cov7" title="4">dulcesIDList, err := useCase.DulcesProvider.GetDulcesListByCarritoID(id)
        if err != nil </span><span class="cov1" title="1">{
                return query.GetDetalleCarrito{}, err
        }</span>

        <span class="cov6" title="3">var dulcesList []query.DulceInCarrito

        for _, dulceInCarrito := range dulcesIDList </span><span class="cov7" title="4">{
                dulce, err := useCase.DulcesProvider.GetDetailByID(dulceInCarrito.DulceID)
                if err != nil </span><span class="cov1" title="1">{
                        return query.GetDetalleCarrito{}, err
                }</span>

                <span class="cov6" title="3">categoriasList, err := useCase.CategoriasProvider.GetCategoriasByDulceID(dulce.ID)
                if err != nil </span><span class="cov1" title="1">{
                        return query.GetDetalleCarrito{}, err
                }</span>

                <span class="cov4" title="2">dulce.AddCategorias(categoriasList)
                dulceInCarritoItem := query.NewDulceInCarrito(dulce, dulceInCarrito.Unidades, dulceInCarrito.Subtotal)

                dulcesList = append(dulcesList, dulceInCarritoItem)</span>
        }

        <span class="cov1" title="1">return query.NewGetDetalleCarrito(carrito, dulcesList), nil</span>
}
</pre>
		
		<pre class="file" id="file10" style="display: none">package getdulcebycode

import (
        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/repositories/providers"
)

type Implementation struct {
        DulcesProvider     providers.DulcesProvider
        CategoriasProvider providers.CategoriasProvider
}

func (UseCase Implementation) Execute(codigo string) (query.DetalleDulce, error) <span class="cov10" title="4">{
        response, err := UseCase.DulcesProvider.GetByCode(codigo)
        if err != nil </span><span class="cov5" title="2">{
                return query.DetalleDulce{}, err
        }</span>
        <span class="cov5" title="2">categorias, err := UseCase.CategoriasProvider.GetCategoriasByDulceID(response.ID)
        if err != nil </span><span class="cov1" title="1">{
                return query.DetalleDulce{}, err
        }</span>

        <span class="cov1" title="1">response.AddCategorias(categorias)

        return response, nil</span>
}
</pre>
		
		<pre class="file" id="file11" style="display: none">package getfiltros

import (
        "Mileyman-API/internal/domain/dto/query"
        "Mileyman-API/internal/repositories/providers"
)

type Implementation struct {
        CategoriasProvider     providers.CategoriasProvider
        MarcasProvider         providers.MarcasProvider
        PresentacionesProvider providers.PresentacionProvider
}

func (UseCase Implementation) Execute() (query.GetFiltros, error) <span class="cov10" title="4">{
        marcas, err := UseCase.MarcasProvider.GetAll()
        if err != nil </span><span class="cov1" title="1">{
                return query.GetFiltros{}, err
        }</span>
        <span class="cov8" title="3">presentaciones, err := UseCase.PresentacionesProvider.GetAll()
        if err != nil </span><span class="cov1" title="1">{
                return query.GetFiltros{}, err
        }</span>
        <span class="cov5" title="2">categorias, err := UseCase.CategoriasProvider.GetAll()
        if err != nil </span><span class="cov1" title="1">{
                return query.GetFiltros{}, err
        }</span>

        <span class="cov1" title="1">return query.GetFiltros{
                Marcas:         marcas,
                Presentaciones: presentaciones,
                Categorias:     categorias,
        }, nil</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
